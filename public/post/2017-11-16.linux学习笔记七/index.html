<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Tao Yan">

  
  
  
    
  
  <meta name="description" content="

awk命令

awk是一种编程语言，用于在unix下处理数据以及文本。数据可以来自stdin、一个或者多个文件或者其它命令的输出，同时支持自定义函数和正则表达式，更多是作为脚本来使用。">

  
  <link rel="alternate" hreflang="en-us" href="https://taoyan.netlify.com/post/2017-11-16.linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%83/">

  


  

  
  
  
  <meta name="theme-color" content="#E13D3D">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/paraiso-light.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/paraiso-light.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin="anonymous">
    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Arapey:400,400i|Karla:400,700|Roboto+Mono|Mrs+Saint+Delafield|Kaushan+Script|Playball&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.271ffa4140fad041464911a0b7fff4cf.css">

  
    
    
    
    
      
    
    
    
    <link rel="stylesheet" href="/css/academic.948c91384be7a6e3e086b01b867a93a8.css">
  

  
  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://taoyan.netlify.com/post/2017-11-16.linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%83/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@TaoYANLogos">
  <meta property="twitter:creator" content="@TaoYANLogos">
  
  <meta property="og:site_name" content="Tao Yan">
  <meta property="og:url" content="https://taoyan.netlify.com/post/2017-11-16.linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%83/">
  <meta property="og:title" content="Linux学习笔记（七） | Tao Yan">
  <meta property="og:description" content="

awk命令

awk是一种编程语言，用于在unix下处理数据以及文本。数据可以来自stdin、一个或者多个文件或者其它命令的输出，同时支持自定义函数和正则表达式，更多是作为脚本来使用。"><meta property="og:image" content="https://taoyan.netlify.com/img/avatar.jpg">
  <meta property="twitter:image" content="https://taoyan.netlify.com/img/avatar.jpg"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2017-11-16T09:19:05&#43;00:00">
    
    <meta property="article:modified_time" content="2017-11-16T09:19:05&#43;00:00">
  

  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#E13D3D",
          "text": "#fbf9f4"
        },
        "button": {
          "background": "#fbf9f4",
          "text": "#E13D3D"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://cookies.insites.com"
      }
    })});
</script>



  





  <title>Linux学习笔记（七） | Tao Yan</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Tao Yan</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#featured"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/CV.pdf"><span>CV</span></a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Linux学习笔记（七）</h1>

  

  
    



<meta content="2017-11-16 09:19:05 &#43;0000 UTC" itemprop="datePublished">
<meta content="2017-11-16 09:19:05 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Nov 16, 2017</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    3 min read
  </span>
  

  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    <a href="/categories/linux/">Linux</a></span>
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://taoyan.netlify.com/post/2017-11-16.linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%83/&amp;text=Linux%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e4%b8%83%ef%bc%89" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://taoyan.netlify.com/post/2017-11-16.linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%83/&amp;t=Linux%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e4%b8%83%ef%bc%89" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Linux%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e4%b8%83%ef%bc%89&amp;body=https://taoyan.netlify.com/post/2017-11-16.linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%83/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://taoyan.netlify.com/post/2017-11-16.linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%83/&amp;title=Linux%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e4%b8%83%ef%bc%89" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Linux%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e4%b8%83%ef%bc%89%20https://taoyan.netlify.com/post/2017-11-16.linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%83/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://taoyan.netlify.com/post/2017-11-16.linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%83/&amp;title=Linux%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e4%b8%83%ef%bc%89" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>
    














  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      <p><img src="https://github.com/YTLogos/Pic_blog/blob/master/97fC0bjE56.png?raw=true" alt="mark" /></p>

<h2 id="awk命令">awk命令</h2>

<p><strong>awk</strong>是一种编程语言，用于在unix下处理数据以及文本。数据可以来自stdin、一个或者多个文件或者其它命令的输出，同时支持自定义函数和正则表达式，更多是作为脚本来使用。</p>

<h2 id="awk命令格式以及选项">awk命令格式以及选项</h2>

<p><strong>awk</strong>使用一个或多个如下结构：</p>

<pre><code>pattren { action }
</code></pre>

<p>每一个pattern是一个表达式或者正则表达式，pattern类似于其它编程语言中的if语句：如果表达式为TRUE或者正则表达式匹配到的话，后面的action命令会被执行。</p>

<h2 id="awk语法形式">awk语法形式</h2>

<pre><code>awk [options] 'script' var=value file(s)
awk [options] -f scriptfile var=value file(s)
</code></pre>

<p>常用命令选项：</p>

<ul>
<li>-F fs：fs指定输入分隔符，fs可以是字符串或者正则表达式</li>
<li>-v var=value：赋值一个用户定义变量，将外部变量传递给awk</li>
<li>-f scriptfile：从脚本文件中读取awk命令</li>
<li>-m[fr] val：对val值设置内在限制，-mf选项限制分配给val的最大块数目；-mr选项限制记录的最大块数目，这两个功能是扩展功能，在标准awk中不适用。</li>
</ul>

<h2 id="awk模式以及操作">awk模式以及操作</h2>

<p>上面已经讲了pattern以及action，awk就是有一个或多个模式与操作组成的。</p>

<h3 id="模式pattern">模式pattern</h3>

<p>pattern可以是以下任意一种：</p>

<ul>
<li>正则表达式</li>
<li>关系表达式：使用运算符操作，可以是字符串或者数字的比较测试</li>
<li>模式匹配表达式：用运算符<code>~</code>(匹配)和<code>!</code>(不匹配)</li>
<li>BEGIN语句块、pattern语句块以及END语句块，涉及十分复杂，后续再讲解</li>
</ul>

<h3 id="操作">操作</h3>

<p>操作由一个或多个命令、函数表达式组成，相互之间使用换行符或者分号分开，并位于大括号内。主要部分是：</p>

<ul>
<li>变量或者数组赋值</li>
<li>输出命令</li>
<li>内置函数</li>
<li>控制流语句</li>
</ul>

<h2 id="awk脚本基本结构">awk脚本基本结构</h2>

<pre><code>awk 'BEGIN{ print &quot;start&quot;} pattern{ command } END{ print &quot;end&quot;}' file
</code></pre>

<p>一个awk脚本通常是由：BEIGIN语句块、能够使用模式匹配的通用语句块、END语句块三部分组成，这三部分是可选的，任意一部分都可以不出现在脚本中。脚本通常是在&rdquo;或&rdquo;&ldquo;中：</p>

<pre><code>awk 'BEGIN{ i=0 } { i++ } END{ print i }' filename
awk &quot;BEGIN{ i=0 } { i++ } END{ print i }&quot; filename
</code></pre>

<h3 id="awk的工作原理">awk的工作原理</h3>

<pre><code>awk 'BEGIN{ commands } pattern{ commands } END{ commands }'
</code></pre>

<p>工作原理：</p>

<ul>
<li>第一步是执行<code>BEGIN{ commands }</code>语句块中的语句</li>
<li>第二步是从文件或者标准输入中读取一行，然后执行<code>pattern{ commands }</code>语句块，它是逐行扫描文件，从第一行到最后一行重复此命令直到文件被完全读取完毕</li>
<li>最后当读至输入流末尾时，执行<code>END{ commands }</code>语句块</li>
</ul>

<p>注意事项：</p>

<ul>
<li><code>BEGIN{ commands }</code>语句块在awk开始从输入流中读取之前被执行，是一个可选语句块，比如变量初始化、打印输出表格的表头等语句通常可以写在此语句块中</li>
<li><code>END{ commands }</code>语句块在awk从输入流中读取所有行之后被执行，比如打印所有行的分析结果这类信息汇总都是在此语句块中完成，也是一个可选语句块</li>
<li><code>pattern{ commands }</code>语句块是最重要的组成部分，也是可选的，如果没有提供此语句块，则默认执行{ print },即打印每一个读取到的行，awk读取到的每一行都会执行该语句块</li>
</ul>

<p>我们举个例子来说明一下：打印出*example.bed*文件的每一行，并且在开始读取之前打印出start，读取完毕之后打印出end</p>

<pre><code>$ awk 'BEGIN{print &quot;start&quot;}{print}END{print &quot;end&quot;}' example.bed
start
chr1    26      39
chr1    32      47
chr3    11      28
chr1    40      49
chr3    16      27
chr1    9       28
chr2    35      54
chr1    10      19
end
</code></pre>

<blockquote>
<p>敲黑板了！！！当print不带任何参数时，它就打印当前行，当print的参数以逗号进行分隔时，打印时则以空格作为定界符，在awk的print语句块中双引号是被当作拼接符来使用的。</p>
</blockquote>

<pre><code>$ echo|awk '{var1=&quot;v1&quot;;var2=&quot;v2&quot;;var3=&quot;v3&quot;;print var1,var2,var3;}'

v1 v2 v3
$ echo|awk '{var1=&quot;v1&quot;;var2=&quot;v2&quot;;var3=&quot;v3&quot;;print var1&quot;=&quot;var2&quot;=&quot;var3;}'

v1=v2=v3
</code></pre>

<p>{}类似于循环体，会对文件每一行进行迭代，通常变量初始化语句(比如i=0)以及打印文件头部的语句放在BEGIN语句块中，而将打印的结果等语句放在END语句块中。</p>

<h2 id="awk内置变量">awk内置变量</h2>

<p>awk内置大量的变量方便我们直接调用</p>

<ul>
<li>$n：当前记录的第n个字段，比如n为1表示第一个字段，n为2表示第二字段，以此类推</li>
<li>$0：表示执行过程中当前行的文本内容</li>
<li>FS：字段分隔符，默认是空格</li>
<li>IGNORECASE：如果为真表示忽略大小写进行匹配</li>
<li>NF：表示字段数，在执行过程中对应于当前的字段数</li>
<li>NR：表示记录数，在执行过程中对应于当前的行号</li>
<li>OFMT：数字的输出格式，默认为%.6g</li>
<li>OFS：输出字段分隔符，默认值为空格</li>
<li>ORS：输出记录分隔符，默认值为一个换行符</li>
<li>RS：记录分隔符：默认是空格</li>
<li>RSTART：由match函数所匹配的字符串的第一个位置</li>
<li>RLENGTH：由match函数所匹配到的字符串的长度</li>
</ul>

<p>举例说明部分变量：</p>

<pre><code>$ head -n 3 example.bed|awk '{print &quot;Line No:&quot;NR&quot;, No of fields:&quot;NF, &quot;$0=&quot;$0,&quot;$1=&quot;$1,&quot;$2=&quot;$2,&quot;$3=&quot;$3}'
Line No:1, No of fields:3 $0=chr1       26      39 $1=chr1 $2=26 $3=39
Line No:2, No of fields:3 $0=chr1       32      47 $1=chr1 $2=32 $3=47
Line No:3, No of fields:3 $0=chr3       11      28 $1=chr3 $2=11 $3=28
</code></pre>

<p>上面我们先选取前三行，然后分别打印出每一行的行号，每一行的字段数以及每一行的每一个字段。
由于NF表示字段数，因此<code>print $NF</code>就会打印出每一行的最后一个字段,<code>print $(NF-1)</code>就会打印出倒数第二个字段，依此类推。</p>

<pre><code>$ head -n 3 example.bed|awk '{print $NF}'
39
47
28
</code></pre>

<p>统计一个文件有多少行可以使用以下命令语句：</p>

<pre><code>$ awk 'END{print NR}' Mus_musculus.GRCm38.75_chr1.gtf
81231
</code></pre>

<p>上面我们只是用了END语句块，在读入每一行时awk会将NR更新为对应的行号，所以当读取到最后一行时就会打印出最后一行的行号NR也就是文件的总行数了。</p>

<h2 id="传递外部变量给awk">传递外部变量给awk</h2>

<p>借助-v选项可以将外部值（非来自stdin）传递给awk：</p>

<pre><code>$ var=1000
$ echo |awk '{print var}' var=&quot;$var&quot;
1000
</code></pre>

<h2 id="awk运算与判断">awk运算与判断</h2>

<p>awk不仅支持算术运算还支持逻辑运算</p>

<h3 id="算术运算符">算术运算符</h3>

<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>

<tbody>
<tr>
<td>+-</td>
<td>加减</td>
</tr>

<tr>
<td>* / &amp;</td>
<td>乘 除 求余</td>
</tr>

<tr>
<td>+-！</td>
<td>一元加减 逻辑非</td>
</tr>

<tr>
<td>^***</td>
<td>求幂</td>
</tr>

<tr>
<td>—++ &ndash;</td>
<td>增加或减少，作为前缀</td>
</tr>
</tbody>
</table>

<blockquote>
<p>所有算术运算符进行操作，操作数自动转为数值，所有非数值转为0</p>
</blockquote>

<h3 id="赋值运算符">赋值运算符</h3>

<p>主要赋值运算符有：= += -= *= /= ……= **=</p>

<p>举例说明：</p>

<pre><code>a+=5,等价于a=a+5.其它类似
</code></pre>

<h3 id="逻辑运算符">逻辑运算符</h3>

<p>就是我们常见的&rdquo;或&rdquo;、&rdquo;与&rdquo;、&rdquo;非&rdquo;</p>

<pre><code>$ awk 'BEGIN{a=1;b=2;print (a&gt;5&amp;&amp;b&gt;2),(a&gt;5||b&lt;=2);}'
0 1
</code></pre>

<h3 id="正则运算符">正则运算符</h3>

<p>主要有~和~！即匹配正则表达式和不匹配</p>

<pre><code>$ awk 'BEGIN{a=&quot;100test&quot;;if(a~/^100*/){print &quot;OK&quot;;}}'
OK
</code></pre>

<h3 id="关系运算符">关系运算符</h3>

<p>主要是&gt;、&gt;=、=、==、!=、&lt;、&lt;=等</p>

<pre><code>$ awk 'BEGIN{a=11;if(a&gt;=9){print &quot;OK&quot;;}}'
OK
</code></pre>

<h3 id="其他运算符">其他运算符</h3>

<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>

<tbody>
<tr>
<td>$</td>
<td>字段引用</td>
</tr>

<tr>
<td>空格</td>
<td>字符串连接符</td>
</tr>

<tr>
<td>?:</td>
<td>C条件表达式</td>
</tr>

<tr>
<td>in</td>
<td>数组中是否存在某值</td>
</tr>
</tbody>
</table>

<h3 id="运算符优先级">运算符优先级</h3>

<p><img src="https://github.com/YTLogos/Pic_blog/blob/master/1JeD56aLBg.png?raw=true" alt="级别越高越优先" /></p>

<h2 id="awk高级输入输出">awk高级输入输出</h2>

<h3 id="next语句读取下一条记录">next语句读取下一条记录</h3>

<p>awk中的next语句使用：在循环逐行匹配，如果遇到next，就会跳过当前行，直接忽略下面的语句而进入下一匹配，一般用于多行匹配</p>

<pre><code>$ awk 'NR%2==1{next}{print NR,$0;}' example.bed
2 chr1  32      47
4 chr1  40      49
6 chr1  9       28
8 chr1  10      19
</code></pre>

<p>后面还有很多复杂用法我暂时不讲了，再者如果遇到更复杂的情况最好使用其他更强大的工具比如python。下面我会讲讲awk如何处理生物信息学数据。</p>

<h3 id="条件筛选">条件筛选</h3>

<p>我们想要将长度大于18的行找出来（即end position-start position&gt;18）</p>

<pre><code>$ awk '$3-$2&gt;18' example.bed
chr1    9       28
chr2    35      54
</code></pre>

<p>下面是一些常用的逻辑操作符</p>

<table>
<thead>
<tr>
<th>Comparison</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>a==b</td>
<td>a is equal to b</td>
</tr>

<tr>
<td>a!=b</td>
<td>a is not equal to b</td>
</tr>

<tr>
<td>a &lt; b</td>
<td>a is less than b</td>
</tr>

<tr>
<td>a &gt; b</td>
<td>a is greater than b</td>
</tr>

<tr>
<td>a &lt;= b</td>
<td>a is less than or equal to b</td>
</tr>

<tr>
<td>a &gt;= b</td>
<td>a is greater than or equal to b</td>
</tr>

<tr>
<td>a ~ b</td>
<td>a matches regular expression pattern b</td>
</tr>

<tr>
<td>a !~ b</td>
<td>a does not match regular expression pattern b</td>
</tr>

<tr>
<td>a &amp;&amp; b</td>
<td>logical and a and b</td>
</tr>

<tr>
<td>!a</td>
<td>not a (logical negation)</td>
</tr>
</tbody>
</table>

<p>筛选出位于染1号染色体上长度大于10的行</p>

<pre><code>$ awk '$1~/chr1/ &amp;&amp; $3-$2&gt;10' example.bed
chr1    26      39
chr1    32      47
chr1    9       28
</code></pre>

<p><code>$1~/chr1/</code>是一正则表达式匹配（正则表达式在符号斜杠里），表示第一列中能匹配到chr1的行，<code>~</code>表示匹配，不匹配的话使用<code>!~</code></p>

<pre><code>$ awk '$1!~/chr1/ &amp;&amp; $3-$2&gt;10' example.bed
chr3    11      28
chr3    16      27
chr2    35      54
</code></pre>

<p>正则表达式结合其他复杂命令（action）可以解决很多复杂问题，比如我们想要将2和3号染色体每行长度都打印出来自成一列：</p>

<pre><code>$ awk '$1!~/chr1/ {print $0 &quot;\t&quot; $3-$2}' example.bed
chr3    11      28      17
chr3    16      27      11
chr2    35      54      19
</code></pre>

<p>目前我们已经讲了awk可以使用的两个功能：</p>

<ul>
<li>结合正则表达式以及算术对数据集进行过滤</li>
<li>利用算术重铸数据集的列</li>
</ul>

<h2 id="begin和end">BEGIN和END</h2>

<p>前面我们已经讲了BEGIN和END，BEGIN在初始化变量方面十分有用，比如如果我们想要求平均长度的话，首先我们可以求和再除以总行数</p>

<pre><code>$ awk 'BEGIN{sum=0};{sum+=($3-$2)};END{print &quot;mean: &quot;sum/NR};' example.bed
mean: 14
</code></pre>

<p>由于NR表示当前行数，因此我们就可以利用它来提取数据集中的数据，比如提取example.bed中的3-5行</p>

<pre><code>$ awk 'NR&gt;=3&amp;&amp;NR&lt;=5' example.bed
chr3    11      28
chr1    40      49
chr3    16      27
</code></pre>

<p>使用awk我们可以很方便的实现BED与GTF文件之间的转换，比如我们可以十分快速的实现从GTF文件中提取出BED文件：</p>

<pre><code>$ awk '!/^#/ {print $1 &quot;\t&quot; $4-1 &quot;\t&quot; $5}' Mus_musculus.GRCm38.75_chr1.gtf|head -n 3
1       3054232 3054733
1       3054232 3054733
1       3054232 3054733
</code></pre>

<blockquote>
<p>这里需要注意的是BED文件索引是从0开始的，GTF索引是从1开始的，因此start position我们需要减去1.</p>
</blockquote>

<p>awk内置了很多函数可以调用：</p>

<table>
<thead>
<tr>
<th>function</th>
<th>description</th>
</tr>
</thead>

<tbody>
<tr>
<td>length(s)</td>
<td>length 0f a string s</td>
</tr>

<tr>
<td>tolower(s)</td>
<td>convert string s to lowercase</td>
</tr>

<tr>
<td>touppper(s)</td>
<td>convert string s to uppercase</td>
</tr>

<tr>
<td>substr(s,i,j)</td>
<td>return the substring of s that starts at i and ends at j</td>
</tr>

<tr>
<td>split(s,x,d)</td>
<td>split string s into chunks by delimiter d,place chunks in array x</td>
</tr>

<tr>
<td>sub(f,r,s)</td>
<td>find regular expression f in s and replace it with r(modifing s in place);use gsub for global substitution;returns a positive value if string is found</td>
</tr>
</tbody>
</table>
    </div>

    
<p class="edit-page">
  <a href="https://github.com/YTLogos/TaoYan/edit/master/content/post%5c2017-11-16.Linux%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%ef%bc%88%e4%b8%83%ef%bc%89.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>



    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/awk/">awk</a>
  
</div>



    
      








  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hufa245e75a5e5fa47274790393ba89624_26717_250x250_fill_q90_lanczos_center.jpg" itemprop="image" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="https://taoyan.netlify.com">Tao Yan</a></h5>
      <h6 class="card-subtitle">PhD Candidate of Crop Science</h6>
      <p class="card-text" itemprop="description">My research interests covers a range of issues:Population Genetics Evolution and Ecotype Divergence Analysis of oilseed Rape, Genome-wide Association Study (GWAS) of Agronomic Traits.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
          <li>
            <a itemprop="sameAs" href="mailto:tyan@zju.edu.cn" >
              <i class="fas fa-paper-plane"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="/#contact" >
              <i class="fas fa-envelope"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://twitter.com/TaoYANLogos" target="_blank" rel="noopener">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/YTLogos" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
    

    

    
<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "logos-1" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>



  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/css.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/bash.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/js.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/markdown.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/html.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin="anonymous"></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    <script id="dsq-count-scr" src="https://logos-1.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    &copy; Tao Yan, 2018-2019 &middot; 

    Made with <i class="far fa-heart" style="color:#E13D3D"></i>, <a href="https://github.com/YTLogos/TaoYan" target="_blank" rel="noopener"><i class="fas fa-code-branch" style="color:#E13D3D"></i></a>, the <a href="https://cran.r-project.org/" target="_blank" rel="noopener"><i class="fab fa-r-project"></i> </a><a href="https://github.com/rstudio/blogdown" target="_blank" rel="noopener">blogdown</a> package, and the 
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

<div style="text-align: center;"><script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5cz8zk3uynm&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33" async="async"></script></div>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
