<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  

  
  
  
    
  
  <meta name="description" content="">

  
  <link rel="alternate" hreflang="en-us" href="https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/">

  


  
  
  
  <meta name="theme-color" content="#06805E">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/tomorrow.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/tomorrow.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,400i%7CKarla:400,400i,700,700i%7CRoboto+Mono%7CKaushan+Script&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-99209585-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-99209585-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hubd7880285348c4660acc9402140a2483_242472_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hubd7880285348c4660acc9402140a2483_242472_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@TaoYANLogos">
  <meta property="twitter:creator" content="@TaoYANLogos">
  
  <meta property="og:site_name" content="Tao Yan">
  <meta property="og:url" content="https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/">
  <meta property="og:title" content="Shiny学习笔记:响应式编程-2 | Tao Yan">
  <meta property="og:description" content=""><meta property="og:image" content="https://taoyan.netlify.app/img/pom-card.png">
  <meta property="twitter:image" content="https://taoyan.netlify.app/img/pom-card.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-04-10T21:19:05&#43;00:00">
    
    <meta property="article:modified_time" content="2020-04-10T21:19:05&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/"
  },
  "headline": "Shiny学习笔记:响应式编程-2",
  
  "datePublished": "2020-04-10T21:19:05Z",
  "dateModified": "2020-04-10T21:19:05Z",
  
  "publisher": {
    "@type": "Organization",
    "name": "Tao Yan",
    "logo": {
      "@type": "ImageObject",
      "url": "https://taoyan.netlify.app/images/icon_hubd7880285348c4660acc9402140a2483_242472_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411172124.png\" alt=\"\"\u003e\u003c/p\u003e"
}
</script>

  

  


  


  





  <title>Shiny学习笔记:响应式编程-2 | Tao Yan</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Tao Yan</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post"><span>Blog</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/publication"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/CV.html"><span>CV</span></a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        

      </ul>

    </div>
  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Shiny学习笔记:响应式编程-2</h1>

  

  
    



<meta content="2020-04-10 21:19:05 &#43;0000 UTC" itemprop="datePublished">
<meta content="2020-04-10 21:19:05 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Apr 10, 2020</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    3 min read
  </span>
  

  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    <a href="/categories/r/">R</a>, <a href="/categories/shiny/">Shiny</a></span>
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/&amp;text=Shiny%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0:%e5%93%8d%e5%ba%94%e5%bc%8f%e7%bc%96%e7%a8%8b-2" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/&amp;t=Shiny%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0:%e5%93%8d%e5%ba%94%e5%bc%8f%e7%bc%96%e7%a8%8b-2" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Shiny%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0:%e5%93%8d%e5%ba%94%e5%bc%8f%e7%bc%96%e7%a8%8b-2&amp;body=https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/&amp;title=Shiny%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0:%e5%93%8d%e5%ba%94%e5%bc%8f%e7%bc%96%e7%a8%8b-2" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>
    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411172124.png" alt=""></p>
<h2 id="reactive-programming">Reactive Programming</h2>
<p>只有输入或者只有输出的<strong>Shiny App</strong>是十分无聊的，当一个<strong>Shiny App</strong>既有输入有有输出，就十分有魅力了：</p>
<pre><code>ui &lt;- fluidPage(
  textInput(&quot;name&quot;, &quot;What's your name?&quot;),
  textOutput(&quot;greeting&quot;)
)

server &lt;- function(input, output, session) {
  output$greeting &lt;- renderText({
    paste0(&quot;Hello &quot;, input$name, &quot;!&quot;)
  })
}
</code></pre>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200410235847.png" alt=""></p>
<p>这就是<strong>Shiny</strong>魅力所在，你无需告诉输出何时更新，<strong>Shiny</strong>会自动帮你完成更新。</p>
<blockquote>
<p>记住一点，<strong>Shiny App</strong>只是提供<code>recipes</code>给<strong>Shiny</strong>，而不是<code>commands</code></p>
</blockquote>
<h3 id="imperative-vs-declarative-programming">Imperative vs declarative programming</h3>
<p>命令式编程与声明式编程之间的关键区别就是<code>recipes</code>与<code>commands</code>的区别：</p>
<ul>
<li>
<p>命令式编程：你敲入一行代码，立即运行，就像在<code>R</code>里面加载数据、转换数据、可视化以及保存结果等</p>
</li>
<li>
<p>声明式编程：你只是传递更高一级的指令，依赖于别人决定如何何时行动，这就是<strong>Shiny</strong>的编程方式。</p>
</li>
</ul>
<h3 id="laziness">Laziness</h3>
<p><strong>Shiny</strong>声明式编程的一个优势允许<code>app</code>极度懒惰。<strong>Shiny</strong>只会做一小部分结果需要更新的工作，其它不必做的一概不做，比如下面例子：</p>
<pre><code>server &lt;- function(input, output, session) {
  output$greetnig &lt;- renderText({
    paste0(&quot;Hello &quot;, input$name, &quot;!&quot;)
  })
}
</code></pre>
<p>就是<code>greetning</code>写错了，<strong>Shiny</strong>是不会报这个错的，但是你无法做任何你想做的事，因为<code>greetning</code>不存在的，<code>renderText()</code>里面的代码永远不会运行。所以多检查你的<code>app</code>是否存在拼写错误。</p>
<h3 id="the-reactive-graph">The reactive graph</h3>
<p>我们平时运行代码的时候是从上到下依次运行，但是<strong>Shiny</strong>不是这样工作的，代码只是在需要的时候才运行。</p>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411001842.png" alt=""></p>
<p>这是一个很简单的<code>reactive graph</code>，如果<code>name</code>发生变化，<code>greeting</code>需要从新运行。</p>
<h3 id="reactive-expressions">Reactive expressions</h3>
<p><strong>Shiny</strong>代码的执行顺序只由<code>reactive graph</code>决定，更代码在<code>server</code>函数中的顺序无关：</p>
<pre><code>server &lt;- function(input, output, session) {
  output$greeting &lt;- renderText(text())
  text &lt;- reactive(paste0(&quot;Hello &quot;, input$name, &quot;!&quot;))
}
</code></pre>
<p>与</p>
<pre><code>server &lt;- function(input, output, session) {
  text &lt;- reactive(paste0(&quot;Hello &quot;, input$name, &quot;!&quot;))
  output$greeting &lt;- renderText(text())
}
</code></pre>
<p>是一样的。</p>
<p>上面我们讲过，为什么<code>reactive expression</code>对于<strong>Shiny</strong>如此重要：</p>
<ul>
<li>
<p>尽可能多地提供<strong>Shiny</strong>信息，这样当输入变化时，<strong>Shiny</strong>尽量少运行计算，<strong>Shiny App</strong>更高效；</p>
</li>
<li>
<p>通过简化<code>reactive graph</code>，<strong>Shiny App</strong>更易理解。</p>
</li>
</ul>
<p>下面通过一个更复杂的<code>app</code>来理解<code>reactive expression</code></p>
<p>假设我们需要通过图表以及假设检验来比较两个数据集，先定义两个函数：</p>
<ul>
<li>
<p><code>histogram()</code>：在一个直方图中可视化两个数据集分布</p>
</li>
<li>
<p><code>t_test()</code>：比较均值及其它值</p>
</li>
</ul>
<pre><code>library(ggplot2)

histogram &lt;- function(x1, x2, binwidth = 0.1, xlim = c(-3, 3)) {
  df &lt;- data.frame(
    x = c(x1, x2),
    g = c(rep(&quot;x1&quot;, length(x1)), rep(&quot;x2&quot;, length(x2)))
  )

  ggplot(df, aes(x, fill = g)) +
    geom_histogram(binwidth = binwidth) +
    coord_cartesian(xlim = xlim)
}

t_test &lt;- function(x1, x2) {
  test &lt;- t.test(x1, x2)
  
  sprintf(
    &quot;p value: %0.3f\n[%0.2f, %0.2f]&quot;,
    test$p.value, test$conf.int[1], test$conf.int[2]
  )
}
</code></pre>
<p>我们模拟两个数据集测试一下两个函数：</p>
<pre><code>x1 &lt;- rnorm(100, mean = 0, sd = 0.5)
x2 &lt;- rnorm(200, mean = 0.15, sd = 0.9)

histogram(x1, x2)
cat(t_test(x1, x2))
#&gt; p value: 0.006
#&gt; [-0.36, -0.06]
</code></pre>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411130923.png" alt=""></p>
<p><strong>Shiny app</strong>开发中尽快能多地从<code>app</code>中提取出代码，<code>app</code>中的代码只负责响应用户点击，<code>app</code>外的函数专门负责运行计算。</p>
<p>下面我们将上述函数封装成一个<code>app</code>，这样我们可以很方便地测试大量的数据集：</p>
<p>根据上面的<code>histogram()</code>函数可以知道，我们需要设计生成两个数据集的输入，每个数据集由<code>n</code>,<code>mean</code>,<code>sd</code>组成，还有一个控制绘图的输入，<code>binwidth</code>，<code>range</code>；两个输出：直方图输出，文本输出，根据我们前面学习的UI设计，我们可以很快就写好UI部分：</p>
<pre><code>ui &lt;- fluidPage(
  fluidRow(
    column(4, 
      &quot;Distribution 1&quot;,
      numericInput(&quot;n1&quot;, label = &quot;n&quot;, value = 1000, min = 1),
      numericInput(&quot;mean1&quot;, label = &quot;µ&quot;, value = 0, step = 0.1),
      numericInput(&quot;sd1&quot;, label = &quot;σ&quot;, value = 0.5, min = 0.1, step = 0.1)
    ),
    column(4, 
      &quot;Distribution 2&quot;,
      numericInput(&quot;n2&quot;, label = &quot;n&quot;, value = 1000, min = 1),
      numericInput(&quot;mean2&quot;, label = &quot;µ&quot;, value = 0, step = 0.1),
      numericInput(&quot;sd2&quot;, label = &quot;σ&quot;, value = 0.5, min = 0.1, step = 0.1)
    ),
    column(4,
      &quot;Histogram&quot;,
      numericInput(&quot;binwidth&quot;, label = &quot;Bin width&quot;, value = 0.1, step = 0.1),
      sliderInput(&quot;range&quot;, label = &quot;range&quot;, value = c(-3, 3), min = -5, max = 5)
    )
  ),
  fluidRow(
    column(9, plotOutput(&quot;hist&quot;)),
    column(3, verbatimTextOutput(&quot;ttest&quot;))
  )
)
</code></pre>
<p><code>server</code>就是调用上面写好的函数，输出结果：</p>
<pre><code>server &lt;- function(input, output, session) {
  output$hist &lt;- renderPlot({
    x1 &lt;- rnorm(input$n1, input$mean1, input$sd1)
    x2 &lt;- rnorm(input$n2, input$mean2, input$sd2)
    
    histogram(x1, x2, binwidth = input$binwidth, xlim = input$range)
  })

  output$ttest &lt;- renderText({
    x1 &lt;- rnorm(input$n1, input$mean1, input$sd1)
    x2 &lt;- rnorm(input$n2, input$mean2, input$sd2)
    
    t_test(x1, x2)
  })
}
</code></pre>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411132155.png" alt=""></p>
<p>我们来理解一下这个<code>app</code>的<code>reactive graph</code>，<strong>Shiny</strong>将整个输出视为一个整体，所以只要<code>n1,mean1,sd1,n2,mean2,sd2</code>中的任何一个发生变化，<code>x1,x2</code>都会自动变化，其<code>reactive graph</code>如下：</p>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411132721.png" alt=""></p>
<p>可以看到<code>reactive graph</code>之间十分紧密，几乎每一个输入都直接关联输入，这就带来两个问题：</p>
<ul>
<li>
<p><code>app</code>之间联系太过紧密，无法隔离开来进行分析</p>
</li>
<li>
<p><code>app</code>十分低效，因为运行了太多不必要的计算。</p>
</li>
</ul>
<p>我们可以使用<code>reactive expression</code>来避免这些问题，<code>reactive()</code>函数将结果赋值给变量x1,x2。</p>
<pre><code>server &lt;- function(input, output, session) {
  x1 &lt;- reactive(rnorm(input$n1, input$mean1, input$sd1))
  x2 &lt;- reactive(rnorm(input$n2, input$mean2, input$sd2))

  output$hist &lt;- renderPlot({
    histogram(x1(), x2(), binwidth = input$binwidth, xlim = input$range)
  })

  output$ttest &lt;- renderText({
    t_test(x1(), x2())
  })
}
</code></pre>
<p>这样就使得<code>reactive graph</code>更简化了：</p>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411133655.png" alt=""></p>
<p>可以看到，当<code>binwidth</code>以及<code>range</code>变化时，只有图是会从新绘制的，数据集是不会变化的，<code>x1</code>，<code>x2</code>也只被相应的输入影响。</p>
<p>复制粘贴一段代码超过三次，那么你应该写个函数，但是在<strong>Shiny</strong>里只要复制粘贴一段代码超过一次，你应该将之写成<code>reactive expression</code>。</p>
<h3 id="控制执行次数">控制执行次数</h3>
<p>我们知道输出会自动随着输入的变化而变化，但是有的时候我们希望当输入变化时输出不要立即变化，但我们需要输出变化时再变化。我们举个例子：</p>
<pre><code>ui &lt;- fluidPage(
  fluidRow(
    column(3, 
      numericInput(&quot;lambda1&quot;, label = &quot;lambda1&quot;, value = 3),
      numericInput(&quot;lambda2&quot;, label = &quot;lambda2&quot;, value = 3),
      numericInput(&quot;n&quot;, label = &quot;n&quot;, value = 1e4, min = 0)
    ),
    column(9, plotOutput(&quot;hist&quot;))
  )
)
server &lt;- function(input, output, session) {
  x1 &lt;- reactive(rpois(input$n, input$lambda1))
  x2 &lt;- reactive(rpois(input$n, input$lambda2))
  output$hist &lt;- renderPlot({
    histogram(x1(), x2(), binwidth = 1, xlim = c(0, 40))
  })
}
</code></pre>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411140324.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411140352.png" alt=""></p>
<p>这里我们介绍一个函数<code>reactiveTimer()</code>来控制一定时间内自动更新的次数，下面的代码设置每分钟更新两次，所以我们不点击任何按钮，图形一直在变，是个动态图。</p>
<pre><code>server &lt;- function(input, output, session) {
  timer &lt;- reactiveTimer(500)
  
  x1 &lt;- reactive({
    timer()
    rpois(input$n, input$lambda1)
  })
  x2 &lt;- reactive({
    timer()
    rpois(input$n, input$lambda2)
  })
  
  output$hist &lt;- renderPlot({
    histogram(x1(), x2(), binwidth = 1, xlim = c(0, 40))
  })
}
</code></pre>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411141851.gif" alt=""></p>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411140834.png" alt=""></p>
<h3 id="点击">点击</h3>
<p>想象一下，当用户不断地点击按钮，服务器端会积压大量的工作，进而导致<code>app</code>响应迟缓，用户体验就十分差了，如果我们设置一个运行按钮，只有输入变化且用户点击了运行按钮，<code>app</code>才会更新，这样就可以节省资源，提高用户体验。这个功能可以由<code>actionButton()</code>实现：</p>
<pre><code>ui &lt;- fluidPage(
  fluidRow(
    column(3, 
      numericInput(&quot;lambda1&quot;, label = &quot;lambda1&quot;, value = 3),
      numericInput(&quot;lambda2&quot;, label = &quot;lambda2&quot;, value = 3),
      numericInput(&quot;n&quot;, label = &quot;n&quot;, value = 1e4, min = 0),
      actionButton(&quot;simulate&quot;, &quot;Simulate!&quot;)
    ),
    column(9, plotOutput(&quot;hist&quot;))
  )
)
</code></pre>
<p>要实现，只有当用户点击<code>Simulate!</code>按钮时，<code>app</code>才运行计算，我们还需要一个新的函数<code>eventReactive()</code>来实现，<code>eventReactive()</code>有两个参数：第一个参数指定哪个依赖，第二个参数指定运行哪些代码，下面的代码允许<code>app</code>只在<code>simulate</code>被点击之后，才运行<code>x1()</code>，<code>x2()</code></p>
<pre><code>server &lt;- function(input, output, session) {
  x1 &lt;- eventReactive(input$simulate, {
    rpois(input$n, input$lambda1)
  })
  x2 &lt;- eventReactive(input$simulate, {
    rpois(input$n, input$lambda2)
  })

  output$hist &lt;- renderPlot({
    histogram(x1(), x2(), binwidth = 1, xlim = c(0, 40))
  })
}
</code></pre>
<p>其<code>reactive graph</code>如下：</p>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411143932.png" alt=""></p>
<blockquote>
<p><code>x1</code>,<code>x2</code>不在响应依赖<code>lambda1</code>，<code>lambda2</code>以及<code>n</code>，这三个输入的变化不会启动计算运行。</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411144439.gif" alt=""></p>
<h2 id="observers">Observers</h2>
<p>目前为止我们只专注于<code>app</code>内部发生了什么，但有时我们需要关注<code>app</code>外面的变化：保存文件，发送数据到API，更新数据库，打印调试信息等，这些不会影响<code>app</code>的外观，你无法使用<code>render</code>来输出，此时就要用到<code>observer</code>。这里只简单介绍如何使用<code>observerEvent()</code>，<code>observerEvent()</code>是一种非常重要的<code>debug</code>工具，<code>observerEvent()</code>与<code>eventReactive()</code>十分相似，有两个参数：<code>eventExpr</code>以及<code>handlerExpr</code>，第一个参数是输入或者表达式的依赖项，第二个参数是需要运行的代码。比如下面的例子表示每次<code>name</code>更新的时候，都会向后台发送信息<code>Greeting performed</code>。</p>
<pre><code>server &lt;- function(input, output, session) {
  text &lt;- reactive(paste0(&quot;Hello &quot;, input$name, &quot;!&quot;))
  
  output$greeting &lt;- renderText(text())
  observeEvent(input$name, {
    message(&quot;Greeting performed&quot;)
  })
}
</code></pre>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411171531.png" alt=""></p>
<p><code>observerEvent()</code>与<code>eventReactive()</code>有两个重要区别：</p>
<ul>
<li>无需将<code>observerEvent()</code>赋值给变量</li>
<li>因此就无法从其它用户获取</li>
</ul>
<p><code>observer</code>与输出紧密相关。</p>
<p><code>Reactive</code>是<strong>Shiny</strong>十分重要的部分，后续还需要不断在实践中加强理解。</p>
<p><img src="https://raw.githubusercontent.com/YTLogos/pic_link/master/img/20200411172124.png" alt=""></p>
<p>参考：https://mastering-shiny.org/basic-reactivity.html</p>
    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/shiny/">shiny</a>
  
  <a class="badge badge-light" href="/tags/reactive/">reactive</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/&amp;text=Shiny%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0:%e5%93%8d%e5%ba%94%e5%bc%8f%e7%bc%96%e7%a8%8b-2" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/&amp;t=Shiny%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0:%e5%93%8d%e5%ba%94%e5%bc%8f%e7%bc%96%e7%a8%8b-2" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Shiny%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0:%e5%93%8d%e5%ba%94%e5%bc%8f%e7%bc%96%e7%a8%8b-2&amp;body=https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://taoyan.netlify.app/post/2020-04-10.shiny%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B2/&amp;title=Shiny%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0:%e5%93%8d%e5%ba%94%e5%bc%8f%e7%bc%96%e7%a8%8b-2" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
  </ul>
</div>












  
  





  
    
    
    
      
    
    
    
    <div class="media author-card content-widget-hr">
      
        
        <img class="avatar mr-3 avatar-circle" src="/authors/alison/avatar_hufa245e75a5e5fa47274790393ba89624_26717_270x270_fill_q90_lanczos_center.jpg" alt="">
      

      <div class="media-body">
        <h5 class="card-title"><a href="https://taoyan.netlify.app/"></a></h5>
        <h6 class="card-subtitle">PhD Candidate of Crop Genetics and Breeding</h6>
        <p class="card-text">I am a PhD student of Crop Genetics and Breeding at the <em>Zhejiang University</em> Crop Science Lab. My research interests covers a range of issues:Population Genetics Evolution and Ecotype Divergence Analysis of Oilseed Rape, Genome-wide Association Study (GWAS) of Agronomic Traits.</p>
        <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:tyan@zju.edu.cn" >
        <i class="fas fa-paper-plane"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:tyan@zju.edu.cn" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/TaoYANLogos" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/YTLogos" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?hl=en&amp;user=8p3wQNwAAAAJ" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
</ul>

      </div>
    </div>
  







<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "logos-1" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>










  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/Shell.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/Python.min.js"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.37431be2d92d7fb0160054761ab79602.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/license/">LICENSE: CC-BY-SA <br> <i class="fab fa-creative-commons fa-2x"></i><i class="fab fa-creative-commons-by fa-2x"></i><i class="fab fa-creative-commons-sa fa-2x"></i> </a><br>
  </p>
  

  <p class="powered-by">
    © Tao Yan, 2018-2020 &middot; 

    Made with <i class="far fa-heart" style="color:#E13D3D"></i>, <a href="https://github.com/YTLogos/TaoYan" target="_blank" rel="noopener"><i class="fas fa-code-branch" style="color:#E13D3D"></i></a>, the <a href="https://cran.r-project.org/" target="_blank" rel="noopener"><i class="fab fa-r-project"></i> </a><a href="https://github.com/rstudio/blogdown" target="_blank" rel="noopener">blogdown</a> package, and the 
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

<div style="text-align: center;"><script type="text/javascript" src="//rf.revolvermaps.com/0/0/6.js?i=5cz8zk3uynm&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=0" async="async"></script></div>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
